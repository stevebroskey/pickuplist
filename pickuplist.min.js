(function(){var s,f,t,u,g,v,w,k,l,m,n,o,p,c,q,x,y,h,r,z,e,A,B=Array.prototype.slice,C=function(a,b){return function(){return a.apply(b,arguments)}};window.WebFontConfig={google:{families:["Droid+Sans:400,700:latin"]}},g=q=c=null,f={},x=function(a,b){return $.getJSON("getgame.php",{id:a},function(a){return b(a)})},e=function(a,b){return f[a]!=null?b(f[a]):x(a,function(c){c!==null&&(f[a]=c);return b(c)})},y=function(a){return e(a,function(b){var d;return b!==null?(d=h(g,a,b.data.description,k(b.data.added)),c.setCenter([b.latitude,b.longitude],14),c.showInfo(d,new google.maps.LatLng(b.latitude,b.longitude)),window.location.hash="#!/"+a):window.location.hash="#!/"})},u=function(a,b){return e(a,function(a){return b("http://maps.google.com/maps?q=to:"+a.latitude+","+a.longitude)})},m=function(a){return u(a,function(a){return self.location.href=a})},l=function(a){return e(a,function(a){return self.location.href="mailto:"+a.data.contact})},n=function(a){return e(a,function(b){var c;c=encodeURIComponent("Flag a post ("+a+")"),b=encodeURIComponent("(Let us know why this post is inappropriate or not longer valid and we'll take it down if it's warranted.)\n\n--\nhttp://pickuplist.com/#!/"+a+" ("+b.latitude+", "+b.longitude+")\n"+b.data.description+"\n");return self.location.href="mailto:flag@pickuplist.com?subject="+c+"&body="+b})},h=function(){var a,b,c,d;a=arguments[0],c=2<=arguments.length?B.call(arguments,1):[],b=a,a=0;for(d=c.length;0<=d?a<=d:a>=d;0<=d?a++:a--)b=b.replace(RegExp("\\{\\$"+(a+1)+"\\}","g"),c[a]);return b},window.init_map=function(){var a,b;c.showMap("map_canvas","1077209"),c.showData_callback(function(a,b){var c;c=eval("("+b+")"),window.location.hash="#!/"+a;return h(g,a,c.description,k(c.added))}),c.newData_callback(function(a){return h(q,"New Activity","type the description of your activity here; don't forget to include things like schedule and any necessary equipment","email address",a.lat(),a.lng())}),c.hideData_callback(function(){return window.location.hash="#!/"}),a=window.location.hash.split(/\//);if(a.length>1&&a[1].length!==0)return b=a[1],a=a.length>=3?a.slice(2,a.length).join("/"):null,a==="directions"?m(b):a==="contact"?l(b):a==="flag"?n(b):y(b);if(window.location.hash="#!/",Modernizr.geolocation)return navigator.geolocation.getCurrentPosition(function(a){return c.setCenter(a,10)})},k=function(a){a=new Date(a);return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a.getDay()]+", "+["January","February","March","April","May","June","July","August","September","October","November","December"][a.getMonth()]+" "+a.getDate()+", "+a.getFullYear()},A=function(){var a,b;a=$(this).width(),$("#keywords").css("width",(a<860?180:a-680)+"px"),a=$(this).height(),a=a-160<460?460:a-160,$("#map .middle").css("height",""+a+"px"),b=$("#content_overlay .message").innerHeight();return $("#content_overlay .message").css("top",(a-b)/2+"px")},p=function(){return c.setLocation($("#location").val())},o=function(){return c.filter($("#keywords").val())},w=function(a){var b,c;b=a.indexOf("@"),c=a.lastIndexOf(".");return a!=="email address"&&c-b>1&&b>0&&c<a.length-2},t=function(a){return a!=="type the description of your activity here; don't forget to include things like schedule and any necessary equipment"&&a.split(/\s+/).length>4},r=function(a){var b;b=$(a).text(),a=$(a).val();return(b.length>a.length?b:a).replace(/\n+/g,"")},s=function(){var a,b,c,d,e,f,g,h,i;d=$("input.email",$(this).parent()),e=w(d.val()),f=d.hasClass("error"),a=$("textarea.description",$(this).parent()),b=t(r(a)),c=a.hasClass("error"),h=$("input.latitude",$(this).parent()).val(),i=$("input.longitude",$(this).parent()).val(),e?d.removeClass("error"):d.addClass("error"),b?a.removeClass("error"):a.addClass("error"),g=[];if(c||f)b||g.push("Please type a longer description."),e||g.push("Please type a valid email address.");g.length>0&&alert("Error"+(g.length>1?"s":"")+":\n - "+g.join("\n - "));if(e&&b)return d=d.val(),a=r(a),$.getJSON("newgame.php",{latitude:h,longitude:i,email:d,description:a},C(function(){$("div.page1",$(this).parent().parent()).hide();return $("div.page2",$(this).parent().parent()).show()},this))},z=function(){$("a[href$='@']").each(function(){return $(this).attr("href","mailto:"+$(this).attr("href")+"pickuplist.com")});return $("a[href^='@']").each(function(){return $(this).attr("href","http://twitter.com/"+$(this).attr("href").substr(1))})},v=function(){$(window).resize(A).resize(),$("#location").keypress(function(a){if(a.which===13)return p()}),$("#location").blur(function(){return p()}),$("#keywords").keypress(function(a){if(a.which===13)return o()}),$("#keywords").blur(function(){return o()}),$("button").live("click",s),$(".infowindow textarea.default").live("click, keypress, select, focus",function(){return $(this).removeClass("default").text("")}),$(".infowindow input.default").live("click, keypress, select, focus",function(){return $(this).removeClass("default").attr("value","")}),$(".infowindow textarea").live("keypress",function(a){if(a.which===13)return a.preventDefault()}),$(".infowindow .error").live("keypress",function(){return $(this).removeClass("error")}),$(".infowindow a[href$='/directions']").live("click",function(a){a.preventDefault();return m($(this).attr("href").split(/\//)[1])}),$(".infowindow a[href$='/contact']").live("click",function(a){a.preventDefault();return l($(this).attr("href").split(/\//)[1])}),$(".infowindow a[href$='/flag']").live("click",function(a){a.preventDefault();return n($(this).attr("href").split(/\//)[1])}),$("a[href='#closeoverlay']").live("click",function(a){a.preventDefault();return $("#content_overlay").fadeOut(200)}),q=$(".defaults #add-game").html(),g=$(".defaults #display-game").html(),$("#nav").show(),z();return c=new pickuplist.Map("init_map")},$script(["http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js","http://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js","http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js","pickuplist-map.min.js"],function(){return $(document).ready(v)})}).call(this)